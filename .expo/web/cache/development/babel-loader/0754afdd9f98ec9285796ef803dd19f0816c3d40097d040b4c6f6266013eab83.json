{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport React, { createContext, useContext, useEffect, useState } from 'react';\nimport * as Location from 'expo-location';\nimport Alert from \"react-native-web/dist/exports/Alert\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nvar LocationContext = createContext(undefined);\nexport var LocationProvider = function LocationProvider(_ref) {\n  var children = _ref.children;\n  var _useState = useState(null),\n    _useState2 = _slicedToArray(_useState, 2),\n    currentLocation = _useState2[0],\n    setCurrentLocation = _useState2[1];\n  var _useState3 = useState(false),\n    _useState4 = _slicedToArray(_useState3, 2),\n    isTracking = _useState4[0],\n    setIsTracking = _useState4[1];\n  var _useState5 = useState([]),\n    _useState6 = _slicedToArray(_useState5, 2),\n    locationHistory = _useState6[0],\n    setLocationHistory = _useState6[1];\n  var _useState7 = useState(false),\n    _useState8 = _slicedToArray(_useState7, 2),\n    hasLocationPermission = _useState8[0],\n    setHasLocationPermission = _useState8[1];\n  var _useState9 = useState(null),\n    _useState0 = _slicedToArray(_useState9, 2),\n    locationSubscription = _useState0[0],\n    setLocationSubscription = _useState0[1];\n  useEffect(function () {\n    checkLocationPermission();\n  }, []);\n  var checkLocationPermission = function () {\n    var _ref2 = _asyncToGenerator(function* () {\n      try {\n        var _yield$Location$getFo = yield Location.getForegroundPermissionsAsync(),\n          status = _yield$Location$getFo.status;\n        if (status === 'granted') {\n          setHasLocationPermission(true);\n          var location = yield Location.getCurrentPositionAsync({\n            accuracy: Location.Accuracy.High\n          });\n          setCurrentLocation({\n            latitude: location.coords.latitude,\n            longitude: location.coords.longitude,\n            altitude: location.coords.altitude || undefined,\n            accuracy: location.coords.accuracy || undefined,\n            speed: location.coords.speed || undefined,\n            heading: location.coords.heading || undefined,\n            timestamp: location.timestamp\n          });\n        }\n      } catch (error) {\n        console.error('Error checking location permission:', error);\n      }\n    });\n    return function checkLocationPermission() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n  var requestLocationPermission = function () {\n    var _ref3 = _asyncToGenerator(function* () {\n      try {\n        var _yield$Location$reque = yield Location.requestForegroundPermissionsAsync(),\n          status = _yield$Location$reque.status;\n        if (status === 'granted') {\n          var backgroundStatus = yield Location.requestBackgroundPermissionsAsync();\n          setHasLocationPermission(true);\n          if (backgroundStatus.status !== 'granted') {\n            Alert.alert('Background Location', 'For best tracking experience, please enable background location access in settings.', [{\n              text: 'OK'\n            }]);\n          }\n          return true;\n        } else {\n          Alert.alert('Location Permission Required', 'This app needs location access to track your routes and measure travel times.', [{\n            text: 'OK'\n          }]);\n          return false;\n        }\n      } catch (error) {\n        console.error('Error requesting location permission:', error);\n        return false;\n      }\n    });\n    return function requestLocationPermission() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n  var startTracking = function () {\n    var _ref4 = _asyncToGenerator(function* () {\n      if (!hasLocationPermission) {\n        var granted = yield requestLocationPermission();\n        if (!granted) return;\n      }\n      try {\n        setIsTracking(true);\n        var subscription = yield Location.watchPositionAsync({\n          accuracy: Location.Accuracy.High,\n          timeInterval: 1000,\n          distanceInterval: 5\n        }, function (location) {\n          var locationData = {\n            latitude: location.coords.latitude,\n            longitude: location.coords.longitude,\n            altitude: location.coords.altitude || undefined,\n            accuracy: location.coords.accuracy || undefined,\n            speed: location.coords.speed || undefined,\n            heading: location.coords.heading || undefined,\n            timestamp: location.timestamp\n          };\n          setCurrentLocation(locationData);\n          setLocationHistory(function (prev) {\n            return [].concat(_toConsumableArray(prev), [locationData]);\n          });\n        });\n        setLocationSubscription(subscription);\n      } catch (error) {\n        console.error('Error starting location tracking:', error);\n        setIsTracking(false);\n      }\n    });\n    return function startTracking() {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n  var stopTracking = function stopTracking() {\n    if (locationSubscription) {\n      locationSubscription.remove();\n      setLocationSubscription(null);\n    }\n    setIsTracking(false);\n  };\n  var clearHistory = function clearHistory() {\n    setLocationHistory([]);\n  };\n  var value = {\n    currentLocation: currentLocation,\n    isTracking: isTracking,\n    locationHistory: locationHistory,\n    hasLocationPermission: hasLocationPermission,\n    startTracking: startTracking,\n    stopTracking: stopTracking,\n    clearHistory: clearHistory,\n    requestLocationPermission: requestLocationPermission\n  };\n  return _jsx(LocationContext.Provider, {\n    value: value,\n    children: children\n  });\n};\nexport var useLocation = function useLocation() {\n  var context = useContext(LocationContext);\n  if (context === undefined) {\n    throw new Error('useLocation must be used within a LocationProvider');\n  }\n  return context;\n};","map":{"version":3,"names":["React","createContext","useContext","useEffect","useState","Location","Alert","jsx","_jsx","LocationContext","undefined","LocationProvider","_ref","children","_useState","_useState2","_slicedToArray","currentLocation","setCurrentLocation","_useState3","_useState4","isTracking","setIsTracking","_useState5","_useState6","locationHistory","setLocationHistory","_useState7","_useState8","hasLocationPermission","setHasLocationPermission","_useState9","_useState0","locationSubscription","setLocationSubscription","checkLocationPermission","_ref2","_asyncToGenerator","_yield$Location$getFo","getForegroundPermissionsAsync","status","location","getCurrentPositionAsync","accuracy","Accuracy","High","latitude","coords","longitude","altitude","speed","heading","timestamp","error","console","apply","arguments","requestLocationPermission","_ref3","_yield$Location$reque","requestForegroundPermissionsAsync","backgroundStatus","requestBackgroundPermissionsAsync","alert","text","startTracking","_ref4","granted","subscription","watchPositionAsync","timeInterval","distanceInterval","locationData","prev","concat","_toConsumableArray","stopTracking","remove","clearHistory","value","Provider","useLocation","context","Error"],"sources":["/Users/xinzan/Road time mesurment tool/src/context/LocationContext.tsx"],"sourcesContent":["import React, { createContext, useContext, useEffect, useState, ReactNode } from 'react';\nimport * as Location from 'expo-location';\nimport { Alert } from 'react-native';\n\ninterface LocationData {\n  latitude: number;\n  longitude: number;\n  altitude?: number;\n  accuracy?: number;\n  speed?: number;\n  heading?: number;\n  timestamp: number;\n}\n\ninterface LocationContextType {\n  currentLocation: LocationData | null;\n  isTracking: boolean;\n  locationHistory: LocationData[];\n  hasLocationPermission: boolean;\n  startTracking: () => Promise<void>;\n  stopTracking: () => void;\n  clearHistory: () => void;\n  requestLocationPermission: () => Promise<boolean>;\n}\n\nconst LocationContext = createContext<LocationContextType | undefined>(undefined);\n\ninterface LocationProviderProps {\n  children: ReactNode;\n}\n\nexport const LocationProvider: React.FC<LocationProviderProps> = ({ children }) => {\n  const [currentLocation, setCurrentLocation] = useState<LocationData | null>(null);\n  const [isTracking, setIsTracking] = useState(false);\n  const [locationHistory, setLocationHistory] = useState<LocationData[]>([]);\n  const [hasLocationPermission, setHasLocationPermission] = useState(false);\n  const [locationSubscription, setLocationSubscription] = useState<Location.LocationSubscription | null>(null);\n\n  useEffect(() => {\n    checkLocationPermission();\n  }, []);\n\n  const checkLocationPermission = async () => {\n    try {\n      const { status } = await Location.getForegroundPermissionsAsync();\n      if (status === 'granted') {\n        setHasLocationPermission(true);\n        // Get initial location\n        const location = await Location.getCurrentPositionAsync({\n          accuracy: Location.Accuracy.High,\n        });\n        setCurrentLocation({\n          latitude: location.coords.latitude,\n          longitude: location.coords.longitude,\n          altitude: location.coords.altitude || undefined,\n          accuracy: location.coords.accuracy || undefined,\n          speed: location.coords.speed || undefined,\n          heading: location.coords.heading || undefined,\n          timestamp: location.timestamp,\n        });\n      }\n    } catch (error) {\n      console.error('Error checking location permission:', error);\n    }\n  };\n\n  const requestLocationPermission = async (): Promise<boolean> => {\n    try {\n      const { status } = await Location.requestForegroundPermissionsAsync();\n      if (status === 'granted') {\n        const backgroundStatus = await Location.requestBackgroundPermissionsAsync();\n        setHasLocationPermission(true);\n        \n        if (backgroundStatus.status !== 'granted') {\n          Alert.alert(\n            'Background Location',\n            'For best tracking experience, please enable background location access in settings.',\n            [{ text: 'OK' }]\n          );\n        }\n        return true;\n      } else {\n        Alert.alert(\n          'Location Permission Required',\n          'This app needs location access to track your routes and measure travel times.',\n          [{ text: 'OK' }]\n        );\n        return false;\n      }\n    } catch (error) {\n      console.error('Error requesting location permission:', error);\n      return false;\n    }\n  };\n\n  const startTracking = async () => {\n    if (!hasLocationPermission) {\n      const granted = await requestLocationPermission();\n      if (!granted) return;\n    }\n\n    try {\n      setIsTracking(true);\n      \n      const subscription = await Location.watchPositionAsync(\n        {\n          accuracy: Location.Accuracy.High,\n          timeInterval: 1000, // Update every second\n          distanceInterval: 5, // Update every 5 meters\n        },\n        (location) => {\n          const locationData: LocationData = {\n            latitude: location.coords.latitude,\n            longitude: location.coords.longitude,\n            altitude: location.coords.altitude || undefined,\n            accuracy: location.coords.accuracy || undefined,\n            speed: location.coords.speed || undefined,\n            heading: location.coords.heading || undefined,\n            timestamp: location.timestamp,\n          };\n          \n          setCurrentLocation(locationData);\n          setLocationHistory(prev => [...prev, locationData]);\n        }\n      );\n      \n      setLocationSubscription(subscription);\n    } catch (error) {\n      console.error('Error starting location tracking:', error);\n      setIsTracking(false);\n    }\n  };\n\n  const stopTracking = () => {\n    if (locationSubscription) {\n      locationSubscription.remove();\n      setLocationSubscription(null);\n    }\n    setIsTracking(false);\n  };\n\n  const clearHistory = () => {\n    setLocationHistory([]);\n  };\n\n  const value: LocationContextType = {\n    currentLocation,\n    isTracking,\n    locationHistory,\n    hasLocationPermission,\n    startTracking,\n    stopTracking,\n    clearHistory,\n    requestLocationPermission,\n  };\n\n  return (\n    <LocationContext.Provider value={value}>\n      {children}\n    </LocationContext.Provider>\n  );\n};\n\nexport const useLocation = (): LocationContextType => {\n  const context = useContext(LocationContext);\n  if (context === undefined) {\n    throw new Error('useLocation must be used within a LocationProvider');\n  }\n  return context;\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}